<script lang="ts">
	import { progressStore } from '$lib/stores/progress';

	let progress = $derived($progressStore);

	// ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ å…¨ä½“ã®æ¦‚è¦ãƒ‡ãƒ¼ã‚¿
	const curriculumOverview = {
		totalHours: '50-60æ™‚é–“',
		targetLevel: 'TypeScript/JavaScriptä¸­ç´šè€…',
		goal: 'ãƒ–ãƒ©ã‚¦ã‚¶æ¨™æº–WebSocket APIã‚’ä½¿ã£ãŸãƒ¢ãƒ€ãƒ³ãªãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆPWAå¯¾å¿œï¼‰ã®è¨­è¨ˆãƒ»å®Ÿè£…',
		techStack: [
			'ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: Svelte/SvelteKit + TypeScript',
			'ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰: Node.js + TypeScript + WebSocketæ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒª',
			'ãƒ†ã‚¹ãƒˆ: Vitest + Playwright',
			'PWA: Service Worker + WebSocketçµ±åˆ'
		]
	};

	// Phaseè©³ç´°ãƒ‡ãƒ¼ã‚¿
	const phases = [
		{
			phase: 1,
			title: 'åŸºç¤ç†è§£',
			duration: '18.5-21.5æ™‚é–“',
			description: 'WebSocketã®æ¦‚å¿µã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æŠ€è¡“ã€APIåŸºæœ¬æ§‹é€ ã‚’ç†è§£',
			color: 'bg-blue-100 text-blue-800 border-blue-200',
			accentColor: 'bg-blue-600',
			sections: [
				{
					id: '1',
					title: 'WebSocket å…¥é–€',
					duration: '5-7æ™‚é–“',
					topics: [
						'WebSocketã¨ã¯ä½•ã‹',
						'HTTPã®é™ç•Œã¨WebSocketã®å„ªä½æ€§',
						'WebSocketã®åˆ©ç”¨ä¾‹ã¨é©ç”¨å ´é¢',
						'WebSocket vs ä»–æŠ€è¡“ã®æ¯”è¼ƒç†è§£'
					]
				},
				{
					id: '2',
					title: 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æŠ€è¡“',
					duration: '6.5-7.5æ™‚é–“',
					topics: [
						'WebSocketã‚’ç†è§£ã™ã‚‹ãŸã‚ã®HTTPåŸºç¤',
						'OSIå‚ç…§ãƒ¢ãƒ‡ãƒ«ã¨WebSocketã®ä½ç½®',
						'HTTP/1.1ã‹ã‚‰HTTP/3ã¾ã§ã®WebSocketå¯¾å¿œ',
						'WebSocketæ¥ç¶šç¢ºç«‹ãƒ—ãƒ­ã‚»ã‚¹',
						'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ãƒãƒ¼ãƒˆç®¡ç†'
					]
				},
				{
					id: '3',
					title: 'WebSocket API ã®åŸºæœ¬æ§‹é€ ',
					duration: '5-6æ™‚é–“',
					topics: [
						'WebSocketæ¥ç¶šãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«',
						'ã‚¤ãƒ™ãƒ³ãƒˆãƒ™ãƒ¼ã‚¹é€šä¿¡ãƒ¢ãƒ‡ãƒ«',
						'ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ»ã‚µãƒ¼ãƒãƒ¼å½¹å‰²åˆ†æ‹…'
					]
				},
				{
					id: '4',
					title: 'WebSocket API ã®åŸºæœ¬æ“ä½œ',
					duration: '4-5æ™‚é–“',
					topics: [
						'WebSocket URL ã¨æ¥ç¶šç¢ºç«‹',
						'ãƒ–ãƒ©ã‚¦ã‚¶æ¨™æº–WebSocket APIå®Ÿè£…',
						'æ¥ç¶šå¤±æ•—ã¨å†æ¥ç¶šå‡¦ç†'
					]
				}
			]
		},
		{
			phase: 2,
			title: 'å®Ÿè£…æŠ€è¡“',
			duration: '17-20æ™‚é–“',
			description: 'ãƒ‡ãƒ¼ã‚¿é€šä¿¡ã€ãƒ•ãƒ¬ãƒ¼ãƒ æ§‹é€ ã€ã‚µãƒ–ãƒ—ãƒ­ãƒˆã‚³ãƒ«è¨­è¨ˆã‚’ç¿’å¾—',
			color: 'bg-green-100 text-green-800 border-green-200',
			accentColor: 'bg-green-600',
			sections: [
				{
					id: '5',
					title: 'WebSocket API ãƒ‡ãƒ¼ã‚¿é€šä¿¡',
					duration: '6-7æ™‚é–“',
					topics: [
						'WebSocketã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨Svelteã‚¹ãƒˆã‚¢',
						'ãƒ‡ãƒ¼ã‚¿é€å—ä¿¡ãƒ‘ã‚¿ãƒ¼ãƒ³',
						'é«˜åº¦ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°'
					]
				},
				{
					id: '6',
					title: 'ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ã¨ã‚µãƒ–ãƒ—ãƒ­ãƒˆã‚³ãƒ«',
					duration: '6-7æ™‚é–“',
					topics: ['WebSocketãƒ•ãƒ¬ãƒ¼ãƒ æ§‹é€ ', 'ãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿é€ä¿¡', 'WebSocketã‚µãƒ–ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®è¨­è¨ˆ']
				},
				{
					id: '7',
					title: 'é«˜åº¦ãªãƒˆãƒ”ãƒƒã‚¯',
					duration: '8-10æ™‚é–“',
					topics: ['ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å®Ÿè£…', 'PWAã¨WebSocketã®çµ±åˆ', 'ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ã¨è² è·å¯¾ç­–']
				}
			]
		},
		{
			phase: 3,
			title: 'ãƒ†ã‚¹ãƒˆãƒ»è©•ä¾¡',
			duration: '8-10æ™‚é–“',
			description: 'ãƒ†ã‚¹ãƒˆæ‰‹æ³•ã€ä»–æŠ€è¡“æ¯”è¼ƒã€é©ç”¨åˆ¤æ–­åŸºæº–ã‚’å­¦ç¿’',
			color: 'bg-purple-100 text-purple-800 border-purple-200',
			accentColor: 'bg-purple-600',
			sections: [
				{
					id: '8',
					title: 'ãƒ†ã‚¹ãƒˆæ‰‹æ³•',
					duration: '5-6æ™‚é–“',
					topics: ['ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ãƒ†ã‚¹ãƒˆ', 'ã‚µãƒ¼ãƒãƒ¼å´ãƒ†ã‚¹ãƒˆ', 'E2Eãƒ†ã‚¹ãƒˆ']
				},
				{
					id: '9',
					title: 'ä»–æŠ€è¡“ã¨ã®æ¯”è¼ƒãƒ»ä½¿ã„åˆ†ã‘',
					duration: '3-4æ™‚é–“',
					topics: ['ä»£æ›¿æŠ€è¡“ã®æ¯”è¼ƒ', 'é©ç”¨åˆ¤æ–­åŸºæº–']
				}
			]
		},
		{
			phase: 4,
			title: 'å®Ÿè·µé–‹ç™º',
			duration: '15-20æ™‚é–“',
			description: 'PWAå¯¾å¿œãƒãƒ£ãƒƒãƒˆã€å…±åŒç·¨é›†ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…',
			color: 'bg-orange-100 text-orange-800 border-orange-200',
			accentColor: 'bg-orange-600',
			sections: [
				{
					id: '10',
					title: 'å®Ÿè·µæ¼”ç¿’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ',
					duration: '15-20æ™‚é–“',
					topics: [
						'PWAå¯¾å¿œãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒ£ãƒƒãƒˆï¼ˆ7-10æ™‚é–“ï¼‰',
						'ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å…±åŒç·¨é›†ã‚·ã‚¹ãƒ†ãƒ ï¼ˆ8-10æ™‚é–“ï¼‰'
					]
				}
			]
		}
	];

	let mounted = $derived(typeof window !== 'undefined');

	// å„Phaseã®é€²æ—ç‡ã‚’è¨ˆç®—
	function getPhaseProgress(phaseNumber: number): number {
		const phaseData = progress.phases[phaseNumber - 1];
		if (!phaseData) return 0;
		return Math.round((phaseData.completedLessons / phaseData.totalLessons) * 100);
	}
</script>

<svelte:head>
	<title>ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ æ¦‚è¦ - WebSocket Learning</title>
	<meta
		name="description"
		content="ãƒ–ãƒ©ã‚¦ã‚¶æ¨™æº–WebSocket APIãƒã‚¹ã‚¿ãƒ¼ã®ãŸã‚ã®50-60æ™‚é–“æ§‹é€ åŒ–ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ ã€‚åŸºç¤ç†è§£ã‹ã‚‰å®Ÿè·µé–‹ç™ºã¾ã§4ã¤ã®Phaseã§æ®µéšçš„ã«ã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ—ã€‚"
	/>
</svelte:head>

<!-- Header Section -->
<section class="bg-gradient-to-r from-primary-600 to-primary-800 text-white py-12">
	<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
		<div class="text-center">
			<h1 class="text-4xl font-bold mb-4">WebSocket Learning ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ </h1>
			<p class="text-xl text-primary-100 mb-6">
				ãƒ–ãƒ©ã‚¦ã‚¶æ¨™æº–WebSocket APIã‚’ä¸­å¿ƒã¨ã—ãŸæ§‹é€ åŒ–å­¦ç¿’ãƒ—ãƒ­ã‚°ãƒ©ãƒ 
			</p>
			<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8">
				<div class="bg-white/10 rounded-lg p-4">
					<div class="text-2xl font-bold">{curriculumOverview.totalHours}</div>
					<div class="text-primary-200">ç·å­¦ç¿’æ™‚é–“</div>
				</div>
				<div class="bg-white/10 rounded-lg p-4">
					<div class="text-2xl font-bold">4 Phases</div>
					<div class="text-primary-200">æ®µéšçš„å­¦ç¿’</div>
				</div>
				<div class="bg-white/10 rounded-lg p-4">
					<div class="text-2xl font-bold">PWAå¯¾å¿œ</div>
					<div class="text-primary-200">å®Ÿè·µçš„ã‚¢ãƒ—ãƒªé–‹ç™º</div>
				</div>
			</div>
		</div>
	</div>
</section>

<!-- å­¦ç¿’ç›®æ¨™ã¨æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ -->
<section class="py-12 bg-white">
	<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
		<div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
			<div class="card">
				<h2 class="text-2xl font-bold text-gray-900 mb-4">ğŸ¯ å­¦ç¿’ç›®æ¨™</h2>
				<div class="space-y-3">
					<div>
						<span class="font-medium text-gray-700">å¯¾è±¡è€…:</span>
						<span class="text-gray-600">{curriculumOverview.targetLevel}</span>
					</div>
					<div>
						<span class="font-medium text-gray-700">æœ€çµ‚ç›®æ¨™:</span>
						<p class="text-gray-600 mt-1">{curriculumOverview.goal}</p>
					</div>
				</div>
			</div>

			<div class="card">
				<h2 class="text-2xl font-bold text-gray-900 mb-4">ğŸ› ï¸ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯</h2>
				<ul class="space-y-2">
					{#each curriculumOverview.techStack as tech (tech)}
						<li class="flex items-start">
							<span class="text-primary-600 mr-2">â€¢</span>
							<span class="text-gray-600">{tech}</span>
						</li>
					{/each}
				</ul>
			</div>
		</div>
	</div>
</section>

<!-- Phaseæ¦‚è¦ -->
<section class="py-16 bg-gray-50">
	<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
		<div class="text-center mb-12">
			<h2 class="text-3xl font-bold text-gray-900 mb-4">å­¦ç¿’ãƒ•ã‚§ãƒ¼ã‚ºæ¦‚è¦</h2>
			<p class="text-lg text-gray-600 max-w-3xl mx-auto">
				4ã¤ã®ãƒ•ã‚§ãƒ¼ã‚ºã§æ®µéšçš„ã«WebSocketæŠ€è¡“ã‚’ãƒã‚¹ã‚¿ãƒ¼ã€‚åŸºç¤ç†è§£ã‹ã‚‰å®Ÿè·µçš„ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–‹ç™ºã¾ã§ä½“ç³»çš„ã«å­¦ç¿’ã—ã¾ã™
			</p>
		</div>

		<div class="space-y-8">
			{#each phases as phase (phase.phase)}
				<div class="card border-l-4 {phase.color.split(' ')[2]} bg-white">
					<div class="flex flex-col lg:flex-row lg:items-center lg:justify-between">
						<!-- Phase Info -->
						<div class="flex-1">
							<div class="flex items-center mb-4">
								<div
									class="{phase.accentColor} text-white w-12 h-12 rounded-full flex items-center justify-center font-bold text-lg mr-4"
								>
									{phase.phase}
								</div>
								<div>
									<h3 class="text-2xl font-bold text-gray-900">
										Phase {phase.phase}: {phase.title}
									</h3>
									<div class="flex items-center space-x-4 mt-1">
										<span
											class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium {phase.color}"
										>
											{phase.duration}
										</span>
										{#if mounted && progress.phases[phase.phase - 1]}
											<span class="text-sm text-gray-500">
												é€²æ—: {getPhaseProgress(phase.phase)}%
											</span>
										{/if}
									</div>
								</div>
							</div>
							<p class="text-gray-600 mb-6">{phase.description}</p>

							<!-- Sections -->
							<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
								{#each phase.sections as section (section.id)}
									<div class="bg-gray-50 rounded-lg p-4">
										<h4 class="font-semibold text-gray-900 mb-2">
											{section.id}. {section.title}
										</h4>
										<div class="text-sm text-gray-500 mb-3">{section.duration}</div>
										<ul class="space-y-1">
											{#each section.topics as topic (topic)}
												<li class="text-sm text-gray-600 flex items-start">
													<span class="text-gray-400 mr-2">â€¢</span>
													<span>{topic}</span>
												</li>
											{/each}
										</ul>
									</div>
								{/each}
							</div>
						</div>

						<!-- Progress & Actions -->
						<div class="lg:ml-8 mt-6 lg:mt-0">
							{#if mounted && progress.phases[phase.phase - 1]}
								{@const phaseProgress = progress.phases[phase.phase - 1]}
								<div class="text-center mb-4">
									<div class="w-20 h-20 mx-auto mb-3 relative">
										<svg class="w-20 h-20 transform -rotate-90" viewBox="0 0 36 36">
											<path
												class="text-gray-200"
												stroke="currentColor"
												stroke-width="3"
												fill="transparent"
												d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
											/>
											<path
												class={phase.accentColor.replace('bg-', 'text-')}
												stroke="currentColor"
												stroke-width="3"
												stroke-linecap="round"
												fill="transparent"
												stroke-dasharray="{(phaseProgress.completedLessons /
													phaseProgress.totalLessons) *
													100}, 100"
												d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
											/>
										</svg>
										<div class="absolute inset-0 flex items-center justify-center">
											<span class="text-sm font-bold text-gray-900">
												{Math.round(
													(phaseProgress.completedLessons / phaseProgress.totalLessons) * 100
												)}%
											</span>
										</div>
									</div>
									<div class="text-sm text-gray-600">
										{phaseProgress.completedLessons}/{phaseProgress.totalLessons} ãƒ¬ãƒƒã‚¹ãƒ³å®Œäº†
									</div>
								</div>
							{/if}

							<div class="space-y-3">
								<a href="/phase{phase.phase}" class="btn-primary w-full text-center block">
									Phase {phase.phase} è©³ç´°ã‚’è¦‹ã‚‹
								</a>
								{#if phase.phase === 1 || (phase.phase > 1 && getPhaseProgress(phase.phase - 1) >= 80)}
									<a href="/lessons/{phase.phase}.1" class="btn-secondary w-full text-center block">
										å­¦ç¿’ã‚’é–‹å§‹
									</a>
								{:else}
									<div class="text-center text-sm text-gray-500">
										Phase {phase.phase - 1} ã‚’80%ä»¥ä¸Šå®Œäº†å¾Œã«é–‹å§‹ã§ãã¾ã™
									</div>
								{/if}
							</div>
						</div>
					</div>
				</div>
			{/each}
		</div>
	</div>
</section>

<!-- å­¦ç¿’ã®é€²ã‚æ–¹ -->
<section class="py-16 bg-white">
	<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
		<div class="text-center mb-12">
			<h2 class="text-3xl font-bold text-gray-900 mb-4">ğŸš€ å­¦ç¿’ã®é€²ã‚æ–¹</h2>
		</div>

		<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
			<div class="text-center">
				<div
					class="w-16 h-16 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-4"
				>
					<span class="text-2xl font-bold">1</span>
				</div>
				<h3 class="font-semibold text-gray-900 mb-2">åŸºç¤</h3>
				<p class="text-sm text-gray-600">WebSocket APIã®åŸºæœ¬æ¦‚å¿µã¨æŠ€è¡“åŸºç›¤ã‚’ç†è§£</p>
			</div>

			<div class="text-center">
				<div
					class="w-16 h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-4"
				>
					<span class="text-2xl font-bold">2</span>
				</div>
				<h3 class="font-semibold text-gray-900 mb-2">å®Ÿè£…</h3>
				<p class="text-sm text-gray-600">ãƒ‡ãƒ¼ã‚¿é€šä¿¡ã¨ã‚µãƒ–ãƒ—ãƒ­ãƒˆã‚³ãƒ«è¨­è¨ˆã‚’ç¿’å¾—</p>
			</div>

			<div class="text-center">
				<div
					class="w-16 h-16 bg-purple-100 text-purple-600 rounded-full flex items-center justify-center mx-auto mb-4"
				>
					<span class="text-2xl font-bold">3</span>
				</div>
				<h3 class="font-semibold text-gray-900 mb-2">è©•ä¾¡</h3>
				<p class="text-sm text-gray-600">ãƒ†ã‚¹ãƒˆæ‰‹æ³•ã¨æŠ€è¡“é¸æŠåˆ¤æ–­ã‚’å­¦ç¿’</p>
			</div>

			<div class="text-center">
				<div
					class="w-16 h-16 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mx-auto mb-4"
				>
					<span class="text-2xl font-bold">4</span>
				</div>
				<h3 class="font-semibold text-gray-900 mb-2">å®Ÿè·µ</h3>
				<p class="text-sm text-gray-600">PWAå¯¾å¿œã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¢ãƒ—ãƒªã‚’é–‹ç™º</p>
			</div>
		</div>

		<div class="mt-12 text-center">
			<div class="bg-primary-50 border border-primary-200 rounded-lg p-6">
				<h3 class="text-lg font-semibold text-primary-800 mb-2">ğŸ’¡ å­¦ç¿’ã®ã‚³ãƒ„</h3>
				<ul class="text-sm text-primary-700 space-y-1">
					<li>â€¢ å„Phaseã‚’é †åºç«‹ã¦ã¦å­¦ç¿’ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨</li>
					<li>â€¢ å®Ÿè·µæ¼”ç¿’ã‚’é‡è¦–ã—ã€æ‰‹ã‚’å‹•ã‹ã—ãªãŒã‚‰ç†è§£ã‚’æ·±ã‚ã‚‹</li>
					<li>â€¢ WebSocket APIã®æ¨™æº–ä»•æ§˜ã‚’å¸¸ã«æ„è­˜ã™ã‚‹</li>
					<li>â€¢ PWAçµ±åˆã‚’æœ€çµ‚ç›®æ¨™ã¨ã—ã¦å®Ÿç”¨çš„ãªã‚¹ã‚­ãƒ«ã‚’èº«ã«ã¤ã‘ã‚‹</li>
				</ul>
			</div>
		</div>
	</div>
</section>
