<script lang="ts">
  import { progressStore, type OverallProgress } from '$lib/stores/progress.js';
  import Mermaid from '$lib/components/Mermaid.svelte';

  let progressData: OverallProgress = $progressStore;

  const sections = [
    {
      id: 'what-is-websocket',
      number: '1.1',
      title: 'WebSocketã¨ã¯ä½•ã‹',
      description: 'WebSocketã®åŸºæœ¬æ¦‚å¿µã¨ãƒ–ãƒ©ã‚¦ã‚¶æ¨™æº–APIã®é‡è¦æ€§ã‚’ç†è§£ã™ã‚‹',
      duration: '60åˆ†',
      difficulty: 'åˆç´š',
      path: '/phase1/introduction/what-is-websocket',
      lessonId: 'phase1-introduction-what-is-websocket'
    },
    {
      id: 'http-limitations',
      number: '1.2',
      title: 'HTTPã®é™ç•Œã¨WebSocketã®å„ªä½æ€§',
      description: 'å¾“æ¥ã®HTTPé€šä¿¡ã®åˆ¶é™ã¨WebSocketãŒè§£æ±ºã™ã‚‹å•é¡Œã‚’ç†è§£ã™ã‚‹',
      duration: '60åˆ†',
      difficulty: 'åˆç´š',
      path: '/phase1/introduction/http-limitations',
      lessonId: 'phase1-introduction-http-limitations'
    },
    {
      id: 'use-cases',
      number: '1.3',
      title: 'WebSocketã®åˆ©ç”¨ä¾‹ã¨é©ç”¨å ´é¢',
      description:
        'WebSocketã®11ã®ä¸»è¦åˆ©ç”¨ä¾‹ã‚’è¦–è¦šçš„ã«ç†è§£ã—ã€å®Ÿéš›ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­è¨ˆã«æ´»ç”¨ã™ã‚‹',
      duration: '90åˆ†',
      difficulty: 'åˆç´š',
      path: '/phase1/introduction/use-cases',
      lessonId: 'phase1-use-cases'
    },
    {
      id: 'comparison',
      number: '1.4',
      title: 'WebSocket vs ä»–æŠ€è¡“ã®æ¯”è¼ƒç†è§£',
      description:
        'WebSocketã¨ä»–ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡æŠ€è¡“ã®ç‰¹å¾´ã‚’æ¯”è¼ƒã—ã€é©åˆ‡ãªæŠ€è¡“é¸æŠãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚‹',
      duration: '60åˆ†',
      difficulty: 'åˆç´š',
      path: '/phase1/introduction/comparison',
      lessonId: 'phase1-introduction-comparison'
    }
  ];

  function getLessonStatus(lessonId: string): 'completed' | 'pending' {
    return progressData?.phases?.flatMap((p) => p.lessons)?.find((l) => l.id === lessonId)
      ?.completed
      ? 'completed'
      : 'pending';
  }

  function getStatusIcon(status: 'completed' | 'pending'): string {
    return status === 'completed' ? 'âœ…' : 'ğŸ“š';
  }

  function getStatusColor(status: 'completed' | 'pending'): string {
    return status === 'completed' ? 'text-green-600' : 'text-gray-600';
  }
</script>

<svelte:head>
  <title>WebSocketå…¥é–€ - Phase 1 Introduction</title>
  <meta
    name="description"
    content="WebSocketã®åŸºæœ¬æ¦‚å¿µã‹ã‚‰å®Ÿè·µçš„ãªåˆ©ç”¨ä¾‹ã¾ã§ã€ä½“ç³»çš„ã«å­¦ç¿’ã™ã‚‹WebSocketå…¥é–€ã‚»ã‚¯ã‚·ãƒ§ãƒ³"
  />
</svelte:head>

<div class="min-h-screen bg-gray-50">
  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
  <div class="bg-gradient-to-br from-blue-600 via-purple-600 to-indigo-700 text-white">
    <div class="max-w-6xl mx-auto px-4 py-16">
      <div class="text-center">
        <div
          class="inline-flex items-center px-4 py-2 bg-white/20 rounded-full text-sm font-medium mb-6"
        >
          ğŸš€ Phase 1: WebSocketåŸºç¤ç†è§£
        </div>
        <h1 class="text-4xl md:text-6xl font-bold mb-6">WebSocketå…¥é–€</h1>
        <p class="text-xl md:text-2xl text-blue-100 mb-8 max-w-3xl mx-auto">
          åŸºæœ¬æ¦‚å¿µã‹ã‚‰å®Ÿè·µçš„ãªåˆ©ç”¨ä¾‹ã¾ã§ã€WebSocketã®å…¨ä½“åƒã‚’ç†è§£ã™ã‚‹
        </p>
        <div class="flex flex-wrap justify-center gap-4 text-sm">
          <div class="flex items-center gap-2 bg-white/20 px-4 py-2 rounded-lg">
            â±ï¸ å­¦ç¿’æ™‚é–“: ç´„4-5æ™‚é–“
          </div>
          <div class="flex items-center gap-2 bg-white/20 px-4 py-2 rounded-lg">
            ğŸ“Š é›£æ˜“åº¦: åˆç´š
          </div>
          <div class="flex items-center gap-2 bg-white/20 px-4 py-2 rounded-lg">
            ğŸ¯ 4ã¤ã®ãƒ¬ãƒƒã‚¹ãƒ³
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="max-w-6xl mx-auto px-4 py-12">
    <!-- å­¦ç¿’ã®æµã‚Œ -->
    <div class="mb-16">
      <h2 class="text-3xl font-bold text-gray-900 mb-8 text-center">å­¦ç¿’ã®æµã‚Œ</h2>

      <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-8 mb-8">
        <Mermaid
          chart={`
graph TD
    A[1.1 WebSocketã¨ã¯ä½•ã‹] --> B[1.2 HTTPã®é™ç•Œã¨å„ªä½æ€§]
    B --> C[1.3 åˆ©ç”¨ä¾‹ã¨é©ç”¨å ´é¢]
    C --> D[1.4 ä»–æŠ€è¡“ã¨ã®æ¯”è¼ƒ]
    
    A1[åŸºæœ¬æ¦‚å¿µç†è§£] --> A
    B1[èª²é¡Œã¨è§£æ±ºç­–] --> B
    C1[å®Ÿè·µçš„å¿œç”¨] --> C
    D1[æŠ€è¡“é¸æŠåˆ¤æ–­] --> D
    
    style A fill:#e3f2fd
    style B fill:#f3e5f5
    style C fill:#e8f5e8
    style D fill:#fff3e0
    style A1 fill:#bbdefb
    style B1 fill:#f8bbd9
    style C1 fill:#c8e6c9
    style D1 fill:#fff8e1
        `}
        />
      </div>
    </div>

    <!-- ãƒ¬ãƒƒã‚¹ãƒ³ä¸€è¦§ -->
    <div class="space-y-6">
      <h2 class="text-3xl font-bold text-gray-900 mb-8 text-center">ãƒ¬ãƒƒã‚¹ãƒ³ä¸€è¦§</h2>

      {#each sections as section, index (section.id)}
        <div
          class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-shadow"
        >
          <div class="p-8">
            <div class="flex items-start justify-between">
              <div class="flex-1">
                <div class="flex items-center gap-4 mb-4">
                  <div
                    class="flex items-center justify-center w-12 h-12 bg-blue-100 text-blue-600 rounded-xl font-bold text-lg"
                  >
                    {section.number}
                  </div>
                  <div>
                    <h3 class="text-xl font-bold text-gray-900">{section.title}</h3>
                    <p class="text-gray-600">{section.description}</p>
                  </div>
                </div>

                <div class="flex flex-wrap gap-4 mb-6">
                  <div class="flex items-center gap-2 text-sm text-gray-600">
                    â±ï¸ {section.duration}
                  </div>
                  <div class="flex items-center gap-2 text-sm text-gray-600">
                    ğŸ“Š {section.difficulty}
                  </div>
                  {#if progressData}
                    <div
                      class="flex items-center gap-2 text-sm {getStatusColor(
                        getLessonStatus(section.lessonId)
                      )}"
                    >
                      {getStatusIcon(getLessonStatus(section.lessonId))}
                      {getLessonStatus(section.lessonId) === 'completed' ? 'å®Œäº†æ¸ˆã¿' : 'æœªå®Œäº†'}
                    </div>
                  {/if}
                </div>

                <a
                  href={section.path}
                  class="inline-flex items-center gap-2 bg-blue-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-blue-700 transition-colors"
                >
                  ãƒ¬ãƒƒã‚¹ãƒ³ã‚’é–‹å§‹ â†’
                </a>
              </div>
            </div>
          </div>

          {#if index < sections.length - 1}
            <div class="border-t border-gray-100 p-4 bg-gray-50">
              <div class="flex items-center justify-center text-gray-400">â†“ æ¬¡ã®ãƒ¬ãƒƒã‚¹ãƒ³ã¸</div>
            </div>
          {/if}
        </div>
      {/each}
    </div>

    <!-- å­¦ç¿’ç›®æ¨™ -->
    <div class="mt-16 bg-white rounded-xl shadow-sm border border-gray-200 p-8">
      <h2 class="text-2xl font-bold text-gray-900 mb-6">ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§èº«ã«ã¤ãã‚¹ã‚­ãƒ«</h2>

      <div class="grid md:grid-cols-2 gap-8">
        <div>
          <h3 class="text-lg font-semibold text-gray-900 mb-4">ğŸ’¡ ç†è«–çš„ç†è§£</h3>
          <ul class="space-y-2 text-gray-600">
            <li class="flex items-start gap-2">
              <span class="text-green-500 mt-1">âœ“</span>
              WebSocketãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®åŸºæœ¬åŸç†
            </li>
            <li class="flex items-start gap-2">
              <span class="text-green-500 mt-1">âœ“</span>
              HTTPã¨ã®é•ã„ã¨æŠ€è¡“çš„å„ªä½æ€§
            </li>
            <li class="flex items-start gap-2">
              <span class="text-green-500 mt-1">âœ“</span>
              ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡ã®å¿…è¦æ€§ã¨èƒŒæ™¯
            </li>
            <li class="flex items-start gap-2">
              <span class="text-green-500 mt-1">âœ“</span>
              ãƒ–ãƒ©ã‚¦ã‚¶æ¨™æº–APIã®é‡è¦æ€§
            </li>
          </ul>
        </div>

        <div>
          <h3 class="text-lg font-semibold text-gray-900 mb-4">ğŸ› ï¸ å®Ÿè·µçš„ã‚¹ã‚­ãƒ«</h3>
          <ul class="space-y-2 text-gray-600">
            <li class="flex items-start gap-2">
              <span class="text-green-500 mt-1">âœ“</span>
              é©åˆ‡ãªæŠ€è¡“é¸æŠã®åˆ¤æ–­åŸºæº–
            </li>
            <li class="flex items-start gap-2">
              <span class="text-green-500 mt-1">âœ“</span>
              11ã®ä¸»è¦åˆ©ç”¨ä¾‹ã®ç†è§£
            </li>
            <li class="flex items-start gap-2">
              <span class="text-green-500 mt-1">âœ“</span>
              ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³ã®é¸æŠ
            </li>
            <li class="flex items-start gap-2">
              <span class="text-green-500 mt-1">âœ“</span>
              ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¦ä»¶ã¨ã®é©åˆæ€§åˆ¤å®š
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚ºã¸ã®æ¡ˆå†… -->
    <div
      class="mt-16 bg-gradient-to-r from-purple-50 to-blue-50 rounded-xl p-8 border border-purple-200"
    >
      <div class="text-center">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">ğŸ¯ Phase 1å®Œäº†å¾Œã¯...</h2>
        <p class="text-gray-600 mb-6 max-w-2xl mx-auto">
          WebSocketã®åŸºç¤ç†è§£ã‚’å®Œäº†ã™ã‚‹ã¨ã€Phase 2ã§ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æŠ€è¡“ã¨ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®è©³ç´°ã€Phase
          3ã§å®Ÿè·µçš„ãªå®Ÿè£…æ‰‹æ³•ã‚’å­¦ç¿’ã—ã¦ã„ãã¾ã™ã€‚
        </p>
        <div class="flex flex-wrap justify-center gap-4">
          <div class="bg-white px-4 py-2 rounded-lg border border-purple-200">
            Phase 2: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æŠ€è¡“åŸºç›¤
          </div>
          <div class="bg-white px-4 py-2 rounded-lg border border-purple-200">
            Phase 3: å®Ÿè£…ã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹
          </div>
          <div class="bg-white px-4 py-2 rounded-lg border border-purple-200">
            Phase 4: é«˜åº¦ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  :global(.mermaid) {
    display: flex;
    justify-content: center;
  }
</style>
