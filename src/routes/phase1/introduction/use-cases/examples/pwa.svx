---
title: 'PWAçµ±åˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è©³ç´°'
description: 'Progressive Web Appçµ±åˆã€Service Workeré€£æºã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œã®WebSocketã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£'
---

<script>
  import Mermaid from '$lib/components/Mermaid.svelte';
</script>

<div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
<div class="prose max-w-none p-8">

# ğŸ“± PWAçµ±åˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è©³ç´°

## 1. PWA + WebSocketçµ±åˆã‚·ã‚¹ãƒ†ãƒ 

### Service Workeré€£æºã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

</div>
</div>

<Mermaid chart={`
graph TB
    subgraph "PWAã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³"
        UI[ğŸ“± PWA UI] --> SW[ğŸ”„ Service Worker]
        SW --> CACHE[ğŸ’¾ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸]
        SW --> IDB[ğŸ“‚ IndexedDB]
        SW --> SYNC[ğŸ”„ Background Sync]
    end
    
    subgraph "ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å±¤"
        UI -->|ã‚ªãƒ³ãƒ©ã‚¤ãƒ³æ™‚| WS[WebSocketã‚µãƒ¼ãƒãƒ¼]
        SW -->|ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰| WS
        WS -->|ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥| PUSH[ğŸ“² Push Service]
        PUSH --> SW
    end
    
    subgraph "ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ©Ÿèƒ½"
        SW --> QUEUE[ğŸ“¤ é€ä¿¡ã‚­ãƒ¥ãƒ¼]
        QUEUE --> RETRY[ğŸ”„ å†é€åˆ¶å¾¡]
        CACHE --> OFFLINE[ğŸ“± ã‚ªãƒ•ãƒ©ã‚¤ãƒ³UI]
        IDB --> HISTORY[ğŸ“š å±¥æ­´ç®¡ç†]
    end
    
    subgraph "ãƒ‡ãƒ¼ã‚¿åŒæœŸ"
        SYNC --> CONFLICT[âš¡ ç«¶åˆè§£æ±º]
        CONFLICT --> MERGE[ğŸ”„ ãƒãƒ¼ã‚¸å‡¦ç†]
        MERGE --> WS
    end
    
    subgraph "é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ "
        WS --> NOTIFY[ğŸ”” Notification API]
        NOTIFY --> BADGE[ğŸ”´ ãƒãƒƒã‚¸æ›´æ–°]
        NOTIFY --> VIBRATE[ğŸ“³ ãƒã‚¤ãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³]
    end
    
    style SW fill:#f3e5f5
    style WS fill:#e8f5e8
    style SYNC fill:#fff3e0
    style NOTIFY fill:#e3f2fd
`} />

<div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
<div class="prose max-w-none p-8">

### ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ»ã‚ªãƒ³ãƒ©ã‚¤ãƒ³çŠ¶æ…‹ç®¡ç†

</div>
</div>

<Mermaid chart={`
sequenceDiagram
    participant UI as PWA UI
    participant SW as Service Worker
    participant WS as WebSocketã‚µãƒ¼ãƒãƒ¼
    participant CACHE as ã‚­ãƒ£ãƒƒã‚·ãƒ¥
    participant QUEUE as é€ä¿¡ã‚­ãƒ¥ãƒ¼

    Note over UI,QUEUE: ã‚ªãƒ³ãƒ©ã‚¤ãƒ³çŠ¶æ…‹
    UI->>WS: WebSocketæ¥ç¶š
    WS->>UI: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿
    UI->>CACHE: ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ£ãƒƒã‚·ãƒ¥
    
    Note over UI,QUEUE: ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ç§»è¡Œ
    UI->>SW: æ¥ç¶šå¤±æ•—æ¤œçŸ¥
    SW->>CACHE: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—
    CACHE->>UI: ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º
    UI->>QUEUE: é€ä¿¡ãƒ‡ãƒ¼ã‚¿è“„ç©
    
    Note over UI,QUEUE: ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¾©å¸°
    SW->>WS: æ¥ç¶šå¾©æ—§
    QUEUE->>WS: è“„ç©ãƒ‡ãƒ¼ã‚¿é€ä¿¡
    WS->>UI: æœ€æ–°ãƒ‡ãƒ¼ã‚¿åŒæœŸ
    SW->>CACHE: ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ›´æ–°
`} />

<div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
<div class="prose max-w-none p-8">

## 2. ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥çµ±åˆã‚·ã‚¹ãƒ†ãƒ 

### ãƒãƒ«ãƒãƒãƒ£ãƒãƒ«é€šçŸ¥é…ä¿¡

</div>
</div>

<Mermaid chart={`
graph TD
    subgraph "é€šçŸ¥ãƒˆãƒªã‚¬ãƒ¼"
        EVENT[ğŸ“… ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿ] --> TRIGGER[âš¡ é€šçŸ¥ãƒˆãƒªã‚¬ãƒ¼]
        SCHED[â° ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«] --> TRIGGER
        USER[ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³] --> TRIGGER
    end
    
    subgraph "é€šçŸ¥åˆ¤å®š"
        TRIGGER --> PREF[âš™ï¸ è¨­å®šç¢ºèª]
        PREF --> ONLINE[ğŸŒ ã‚ªãƒ³ãƒ©ã‚¤ãƒ³çŠ¶æ…‹ç¢ºèª]
        ONLINE --> CHANNEL[ğŸ“¡ é…ä¿¡ãƒãƒ£ãƒãƒ«é¸æŠ]
    end
    
    subgraph "PWAé…ä¿¡"
        CHANNEL -->|ã‚ªãƒ³ãƒ©ã‚¤ãƒ³| WS[WebSocketã‚µãƒ¼ãƒãƒ¼]
        WS --> PWA[ğŸ“± PWAã‚¢ãƒ—ãƒª]
        PWA --> DISPLAY[ğŸ“± ã‚¤ãƒ³ã‚¢ãƒ—ãƒªé€šçŸ¥]
    end
    
    subgraph "ãƒ—ãƒƒã‚·ãƒ¥é…ä¿¡"
        CHANNEL -->|ã‚ªãƒ•ãƒ©ã‚¤ãƒ³| PUSH[ğŸ“² Push Service]
        PUSH --> SW[ğŸ”„ Service Worker]
        SW --> NOTIF[ğŸ”” ãƒ–ãƒ©ã‚¦ã‚¶é€šçŸ¥]
        SW --> BADGE[ğŸ”´ ã‚¢ãƒ—ãƒªãƒãƒƒã‚¸]
    end
    
    subgraph "ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯"
        CHANNEL -->|å¤±æ•—æ™‚| EMAIL[ğŸ“§ ãƒ¡ãƒ¼ãƒ«é€šçŸ¥]
        CHANNEL -->|å¤±æ•—æ™‚| SMS[ğŸ“± SMSé€šçŸ¥]
    end
    
    subgraph "åˆ†æãƒ»æœ€é©åŒ–"
        DISPLAY --> METRICS[ğŸ“Š é…ä¿¡çµ±è¨ˆ]
        NOTIF --> METRICS
        EMAIL --> METRICS
        METRICS --> OPT[âš¡ é…ä¿¡æœ€é©åŒ–]
    end
    
    style WS fill:#f3e5f5
    style PUSH fill:#e8f5e8
    style SW fill:#fff3e0
    style METRICS fill:#e3f2fd
`} />

<div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
<div class="prose max-w-none p-8">

## 3. ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆè¨­è¨ˆ

### ãƒ‡ãƒ¼ã‚¿åŒæœŸæˆ¦ç•¥

</div>
</div>

<Mermaid chart={`
graph LR
    subgraph "ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸"
        UI[ğŸ“± ãƒ¦ãƒ¼ã‚¶ãƒ¼UI] --> LOCAL[ğŸ’¾ ãƒ­ãƒ¼ã‚«ãƒ«DB]
        LOCAL --> CACHE[âš¡ ã‚­ãƒ£ãƒƒã‚·ãƒ¥å±¤]
        CACHE --> INDEX[ğŸ“‚ IndexedDB]
    end
    
    subgraph "åŒæœŸã‚¨ãƒ³ã‚¸ãƒ³"
        CACHE --> SYNC[ğŸ”„ åŒæœŸã‚¨ãƒ³ã‚¸ãƒ³]
        SYNC --> DIFF[ğŸ“Š å·®åˆ†è¨ˆç®—]
        DIFF --> CONFLICT[âš¡ ç«¶åˆæ¤œçŸ¥]
        CONFLICT --> RESOLVE[ğŸ”§ ç«¶åˆè§£æ±º]
    end
    
    subgraph "ã‚µãƒ¼ãƒãƒ¼é€£æº"
        RESOLVE --> WS[WebSocketã‚µãƒ¼ãƒãƒ¼]
        WS --> SERVER[ğŸ—„ï¸ ã‚µãƒ¼ãƒãƒ¼DB]
        SERVER --> BACKUP[ğŸ’¾ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—]
    end
    
    subgraph "åŒæœŸãƒ‘ã‚¿ãƒ¼ãƒ³"
        WS --> REALTIME[âš¡ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ]
        WS --> BATCH[ğŸ“¦ ãƒãƒƒãƒåŒæœŸ]
        WS --> EVENTUAL[ğŸ”„ çµæœæ•´åˆæ€§]
    end
    
    subgraph "åŒæœŸåˆ¶å¾¡"
        SYNC --> POLICY[ğŸ“‹ åŒæœŸãƒãƒªã‚·ãƒ¼]
        POLICY --> PRIORITY[ğŸ“Š å„ªå…ˆåº¦åˆ¶å¾¡]
        PRIORITY --> SCHEDULE[â° ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°]
    end
    
    style SYNC fill:#f3e5f5
    style CONFLICT fill:#ffebee
    style WS fill:#e8f5e8
    style POLICY fill:#fff3e0
`} />

<div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
<div class="prose max-w-none p-8">

### ç«¶åˆè§£æ±ºãƒ¡ã‚«ãƒ‹ã‚ºãƒ 

</div>
</div>

<Mermaid chart={`
sequenceDiagram
    participant A as ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆA
    participant B as ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆB
    participant S as åŒæœŸã‚µãƒ¼ãƒãƒ¼
    participant R as ç«¶åˆè§£æ±ºã‚¨ãƒ³ã‚¸ãƒ³

    Note over A,R: åŒæœŸç«¶åˆã‚·ãƒŠãƒªã‚ª
    
    A->>S: ãƒ‡ãƒ¼ã‚¿æ›´æ–° (v1 -> v2)
    B->>S: ãƒ‡ãƒ¼ã‚¿æ›´æ–° (v1 -> v3)
    
    S->>R: ç«¶åˆæ¤œçŸ¥ (v2 vs v3)
    R->>R: ç«¶åˆè§£æ±ºã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ å®Ÿè¡Œ
    
    alt Last Writer Wins
        R->>S: v3ã‚’æ¡ç”¨ (æœ€æ–°ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—)
        S->>A: v3ã«æ›´æ–°æŒ‡ç¤º
        S->>B: v3ç¢ºèª
    else Merge Resolution
        R->>S: v2ã¨v3ã‚’ãƒãƒ¼ã‚¸ã—ã¦v4ç”Ÿæˆ
        S->>A: v4ã«æ›´æ–°æŒ‡ç¤º
        S->>B: v4ã«æ›´æ–°æŒ‡ç¤º
    else User Resolution
        R->>A: ç«¶åˆè§£æ±ºUIè¡¨ç¤º
        A->>R: ãƒ¦ãƒ¼ã‚¶ãƒ¼é¸æŠ
        R->>S: é¸æŠçµæœé©ç”¨
        S->>B: è§£æ±ºçµæœé…ä¿¡
    end
    
    Note over A,R: ä¸€è²«æ€§å¾©æ—§å®Œäº†
`} />

<div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
<div class="prose max-w-none p-8">

## 4. PWAãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†

### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹ç®¡ç†

</div>
</div>

<Mermaid chart={`
graph TD
    subgraph "PWAãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«"
        INSTALL[ğŸ“¥ ã‚¢ãƒ—ãƒªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«] --> ACTIVE[âœ… ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹]
        ACTIVE --> BACKGROUND[ğŸ”„ ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰]
        BACKGROUND --> FOREGROUND[ğŸ“± ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰]
        FOREGROUND --> ACTIVE
        ACTIVE --> SUSPEND[ğŸ˜´ ã‚µã‚¹ãƒšãƒ³ãƒ‰]
        SUSPEND --> ACTIVE
    end
    
    subgraph "WebSocketç®¡ç†"
        ACTIVE --> CONNECT[ğŸ”Œ WebSocketæ¥ç¶š]
        BACKGROUND --> MAINTAIN[ğŸ”„ æ¥ç¶šç¶­æŒ]
        SUSPEND --> DISCONNECT[âŒ æ¥ç¶šåˆ‡æ–­]
        FOREGROUND --> RECONNECT[ğŸ”„ å†æ¥ç¶š]
    end
    
    subgraph "ãƒ‡ãƒ¼ã‚¿ç®¡ç†"
        CONNECT --> REALTIME[âš¡ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å—ä¿¡]
        MAINTAIN --> HEARTBEAT[ğŸ’“ ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆ]
        DISCONNECT --> QUEUE[ğŸ“¤ é€ä¿¡ã‚­ãƒ¥ãƒ¼]
        RECONNECT --> SYNC[ğŸ”„ ãƒ‡ãƒ¼ã‚¿åŒæœŸ]
    end
    
    subgraph "ãƒªã‚½ãƒ¼ã‚¹æœ€é©åŒ–"
        BACKGROUND --> THROTTLE[â³ å‡¦ç†é–“å¼•ã]
        SUSPEND --> CLEANUP[ğŸ§¹ ãƒªã‚½ãƒ¼ã‚¹è§£æ”¾]
        FOREGROUND --> RESUME[â–¶ï¸ å‡¦ç†å†é–‹]
    end
    
    style CONNECT fill:#e8f5e8
    style MAINTAIN fill:#fff3e0
    style SYNC fill:#f3e5f5
    style THROTTLE fill:#e3f2fd
`} />

<div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
<div class="prose max-w-none p-8">

## 5. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ã¨ãƒ‡ãƒ¼ã‚¿åœ§ç¸®

</div>
</div>

<Mermaid chart={`
graph TB
    subgraph "ã‚­ãƒ£ãƒƒã‚·ãƒ¥éšå±¤"
        L1[âš¡ L1: ãƒ¡ãƒ¢ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥] --> L2[ğŸ’¾ L2: ãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥]
        L2 --> L3[ğŸ“‚ L3: IndexedDB]
        L3 --> L4[ğŸŒ L4: CDNã‚­ãƒ£ãƒƒã‚·ãƒ¥]
    end
    
    subgraph "ãƒ‡ãƒ¼ã‚¿åœ§ç¸®"
        WS[WebSocketã‚µãƒ¼ãƒãƒ¼] --> COMP[ğŸ—œï¸ åœ§ç¸®ã‚¨ãƒ³ã‚¸ãƒ³]
        COMP --> GZIP[ğŸ“¦ Gzipåœ§ç¸®]
        COMP --> DELTA[ğŸ”„ å·®åˆ†åœ§ç¸®]
        COMP --> BINARY[ğŸ’¾ ãƒã‚¤ãƒŠãƒªå½¢å¼]
    end
    
    subgraph "é…ä¿¡æœ€é©åŒ–"
        COMP --> ADAPTIVE[ğŸ“Š é©å¿œé…ä¿¡]
        ADAPTIVE --> BANDWIDTH[ğŸ“¡ å¸¯åŸŸå¹…æ¤œçŸ¥]
        BANDWIDTH --> QUALITY[ğŸ›ï¸ å“è³ªèª¿æ•´]
        QUALITY --> PRIORITY[ğŸ“Š å„ªå…ˆåº¦åˆ¶å¾¡]
    end
    
    subgraph "ãƒ—ãƒªãƒ­ãƒ¼ãƒ‰æˆ¦ç•¥"
        L1 --> PREFETCH[ğŸ”® ãƒ—ãƒªãƒ•ã‚§ãƒƒãƒ]
        PREFETCH --> PREDICT[ğŸ¤– äºˆæ¸¬èª­ã¿è¾¼ã¿]
        PREDICT --> CRITICAL[ğŸ¯ ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãƒ‘ã‚¹]
    end
    
    style COMP fill:#f3e5f5
    style ADAPTIVE fill:#e8f5e8
    style PREFETCH fill:#fff3e0
    style CRITICAL fill:#e3f2fd
`} />

<div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
<div class="prose max-w-none p-8">

## 6. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å®Ÿè£…

### PWAã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

</div>
</div>

<Mermaid chart={`
graph LR
    subgraph "èªè¨¼ãƒ»èªå¯"
        USER[ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼] --> AUTH[ğŸ” èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ]
        AUTH --> JWT[ğŸ« JWTãƒˆãƒ¼ã‚¯ãƒ³]
        JWT --> REFRESH[ğŸ”„ ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥]
    end
    
    subgraph "é€šä¿¡ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£"
        JWT --> WSS[ğŸ”’ WSS (WebSocket Secure)]
        WSS --> TLS[ğŸ›¡ï¸ TLS 1.3]
        TLS --> CERT[ğŸ“œ è¨¼æ˜æ›¸æ¤œè¨¼]
    end
    
    subgraph "ãƒ‡ãƒ¼ã‚¿ä¿è­·"
        WSS --> ENCRYPT[ğŸ” ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æš—å·åŒ–]
        ENCRYPT --> SIGN[âœï¸ ãƒ‡ã‚¸ã‚¿ãƒ«ç½²å]
        SIGN --> INTEGRITY[ğŸ” å®Œå…¨æ€§æ¤œè¨¼]
    end
    
    subgraph "ãƒ­ãƒ¼ã‚«ãƒ«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£"
        ENCRYPT --> STORAGE[ğŸ’¾ ã‚»ã‚­ãƒ¥ã‚¢ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸]
        STORAGE --> KEYCHAIN[ğŸ”‘ ã‚­ãƒ¼ãƒã‚§ãƒ¼ãƒ³]
        KEYCHAIN --> SANDBOX[ğŸ“¦ ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹]
    end
    
    subgraph "ç›£æŸ»ãƒ»ç›£è¦–"
        INTEGRITY --> LOG[ğŸ“‹ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ­ã‚°]
        LOG --> SIEM[ğŸš¨ SIEMé€£æº]
        SIEM --> ALERT[ğŸ”” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒ©ãƒ¼ãƒˆ]
    end
    
    style AUTH fill:#f3e5f5
    style WSS fill:#e8f5e8
    style ENCRYPT fill:#fff3e0
    style LOG fill:#e3f2fd
`} />

<div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
<div class="prose max-w-none p-8">

## ğŸ’¡ å®Ÿè£…ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 1. Service Worker WebSocketç®¡ç†
```javascript
// service-worker.js
class PWAWebSocketManager {
  constructor() {
    this.ws = null;
    this.reconnectAttempts = 0;
    this.maxReconnectAttempts = 5;
    this.messageQueue = [];
  }
  
  connect() {
    if (this.ws?.readyState === WebSocket.OPEN) return;
    
    this.ws = new WebSocket('wss://api.example.com/ws');
    
    this.ws.onopen = () => {
      console.log('WebSocket connected in SW');
      this.reconnectAttempts = 0;
      this.flushMessageQueue();
    };
    
    this.ws.onmessage = (event) => {
      const data = JSON.parse(event.data);
      this.handleMessage(data);
    };
    
    this.ws.onclose = () => {
      this.scheduleReconnect();
    };
  }
  
  handleMessage(data) {
    // ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç†
    if (data.type === 'notification') {
      this.showNotification(data);
    } else if (data.type === 'update') {
      this.updateCache(data);
    }
  }
  
  showNotification(data) {
    self.registration.showNotification(data.title, {
      body: data.body,
      icon: '/icon-192x192.png',
      badge: '/badge-72x72.png',
      actions: data.actions || [],
      tag: data.tag,
      requireInteraction: data.urgent
    });
  }
}
```

### 2. ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œãƒ‡ãƒ¼ã‚¿åŒæœŸ
```javascript
class OfflineDataSync {
  constructor() {
    this.db = new IDBDatabase('pwa-data');
    this.syncQueue = new Map();
    this.conflictResolver = new ConflictResolver();
  }
  
  async saveData(key, data) {
    // ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜
    await this.db.put('data', { key, data, timestamp: Date.now() });
    
    // ã‚ªãƒ³ãƒ©ã‚¤ãƒ³æ™‚ã¯å³åº§åŒæœŸ
    if (navigator.onLine) {
      this.syncToServer(key, data);
    } else {
      // ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã¯ã‚­ãƒ¥ãƒ¼ã«è¿½åŠ 
      this.syncQueue.set(key, { data, timestamp: Date.now() });
    }
  }
  
  async syncToServer(key, data) {
    try {
      const response = await fetch('/api/sync', {
        method: 'POST',
        body: JSON.stringify({ key, data }),
        headers: { 'Content-Type': 'application/json' }
      });
      
      if (!response.ok) {
        throw new Error('Sync failed');
      }
      
      // æˆåŠŸæ™‚ã¯ã‚­ãƒ¥ãƒ¼ã‹ã‚‰å‰Šé™¤
      this.syncQueue.delete(key);
    } catch (error) {
      // å¤±æ•—æ™‚ã¯ã‚­ãƒ¥ãƒ¼ã«è¿½åŠ 
      this.syncQueue.set(key, { data, timestamp: Date.now() });
    }
  }
  
  async resolveConflicts() {
    for (const [key, localData] of this.syncQueue) {
      const serverData = await this.fetchServerData(key);
      
      if (serverData && serverData.timestamp > localData.timestamp) {
        // ã‚µãƒ¼ãƒãƒ¼å´ãŒæ–°ã—ã„å ´åˆ
        const resolved = await this.conflictResolver.resolve(
          localData.data, 
          serverData.data
        );
        await this.saveData(key, resolved);
      }
    }
  }
}
```

### 3. ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥çµ±åˆ
```javascript
class PWAPushNotifications {
  constructor() {
    this.registration = null;
    this.subscription = null;
  }
  
  async initialize() {
    // Service Workerç™»éŒ²
    this.registration = await navigator.serviceWorker.register('/sw.js');
    
    // ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥æ¨©é™è¦æ±‚
    const permission = await Notification.requestPermission();
    if (permission === 'granted') {
      await this.subscribeToPush();
    }
  }
  
  async subscribeToPush() {
    const vapidPublicKey = 'BEl62iUYgUivxIkv69yViEuiBIa40HI80Y...';
    
    this.subscription = await this.registration.pushManager.subscribe({
      userVisibleOnly: true,
      applicationServerKey: this.urlBase64ToUint8Array(vapidPublicKey)
    });
    
    // ã‚µãƒ¼ãƒãƒ¼ã«ç™»éŒ²æƒ…å ±é€ä¿¡
    await this.sendSubscriptionToServer(this.subscription);
  }
  
  async sendSubscriptionToServer(subscription) {
    const ws = new WebSocket('wss://api.example.com/ws');
    
    ws.onopen = () => {
      ws.send(JSON.stringify({
        type: 'subscribe',
        subscription: subscription.toJSON()
      }));
    };
  }
  
  urlBase64ToUint8Array(base64String) {
    const padding = '='.repeat((4 - base64String.length % 4) % 4);
    const base64 = (base64String + padding)
      .replace(/-/g, '+')
      .replace(/_/g, '/');
    
    const rawData = window.atob(base64);
    const outputArray = new Uint8Array(rawData.length);
    
    for (let i = 0; i < rawData.length; ++i) {
      outputArray[i] = rawData.charCodeAt(i);
    }
    return outputArray;
  }
}
```

### 4. é©å¿œçš„å“è³ªåˆ¶å¾¡
```javascript
class AdaptiveQualityController {
  constructor() {
    this.connection = navigator.connection || navigator.mozConnection;
    this.qualitySettings = {
      '4g': { compression: 'medium', updateRate: 100 },
      '3g': { compression: 'high', updateRate: 500 },
      '2g': { compression: 'max', updateRate: 2000 }
    };
  }
  
  getOptimalSettings() {
    const effectiveType = this.connection?.effectiveType || '4g';
    const downlink = this.connection?.downlink || 10;
    
    let settings = this.qualitySettings[effectiveType];
    
    // å‹•çš„èª¿æ•´
    if (downlink < 1) {
      settings = { ...settings, compression: 'max', updateRate: 5000 };
    } else if (downlink > 10) {
      settings = { ...settings, compression: 'none', updateRate: 50 };
    }
    
    return settings;
  }
  
  adaptWebSocketSettings(ws) {
    const settings = this.getOptimalSettings();
    
    // WebSocketã‚µãƒ¼ãƒãƒ¼ã«å“è³ªè¨­å®šã‚’é€šçŸ¥
    ws.send(JSON.stringify({
      type: 'quality_settings',
      compression: settings.compression,
      updateRate: settings.updateRate
    }));
    
    // æ¥ç¶šçŠ¶æ…‹ç›£è¦–
    this.connection?.addEventListener('change', () => {
      const newSettings = this.getOptimalSettings();
      ws.send(JSON.stringify({
        type: 'quality_settings',
        compression: newSettings.compression,
        updateRate: newSettings.updateRate
      }));
    });
  }
}
```

ã“ã®åŒ…æ‹¬çš„ãªPWAçµ±åˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã‚ˆã‚Šã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œã‹ã¤é«˜æ€§èƒ½ãªWebSocketã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚

</div>
</div>