---
title: 'é€šçŸ¥ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆã‚·ã‚¹ãƒ†ãƒ è©³ç´°'
description: 'ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šçŸ¥ã€ãƒ—ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€ã‚·ã‚¹ãƒ†ãƒ ç›£è¦–ã‚¢ãƒ©ãƒ¼ãƒˆã®WebSocketã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£'
---

<script>
  import Mermaid from '$lib/components/Mermaid.svelte';
</script>

<div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
<div class="prose max-w-none p-8">

# ğŸ”” é€šçŸ¥ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆã‚·ã‚¹ãƒ†ãƒ è©³ç´°

## 1. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šçŸ¥é…ä¿¡ã‚·ã‚¹ãƒ†ãƒ 

### ãƒãƒ«ãƒãƒãƒ£ãƒãƒ«é€šçŸ¥ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

</div>
</div>

<Mermaid chart={`
graph TB
    subgraph "ã‚¤ãƒ™ãƒ³ãƒˆã‚½ãƒ¼ã‚¹"
        A[ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³] --> E[ğŸ“… ã‚¤ãƒ™ãƒ³ãƒˆã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼]
        B[â° ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¿ã‚¹ã‚¯] --> E
        C[ğŸš¨ ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ©ãƒ¼ãƒˆ] --> E
        D[ğŸ”§ APIå‘¼ã³å‡ºã—] --> E
    end
    
    subgraph "é€šçŸ¥ã‚¨ãƒ³ã‚¸ãƒ³"
        E --> F[ğŸ¯ ã‚¿ãƒ¼ã‚²ãƒ†ã‚£ãƒ³ã‚°]
        F --> G[ğŸ“ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆ]
        G --> H[ğŸ”„ é…ä¿¡ãƒ«ãƒ¼ã‚¿ãƒ¼]
    end
    
    subgraph "é…ä¿¡ãƒãƒ£ãƒãƒ«"
        H -->|WebSocket| I[ğŸ’» Webãƒ–ãƒ©ã‚¦ã‚¶]
        H -->|WebSocket| J[ğŸ“± PWAã‚¢ãƒ—ãƒª]
        H -->|Push API| K[ğŸ“² ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒª]
        H -->|WebSocket| L[ğŸ–¥ï¸ ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—]
        H -->|Email| M[ğŸ“§ ãƒ¡ãƒ¼ãƒ«]
        H -->|SMS| N[ğŸ“± SMS]
    end
    
    subgraph "ç®¡ç†æ©Ÿèƒ½"
        O[âš™ï¸ è¨­å®šç®¡ç†] --> F
        P[ğŸ“Š é…ä¿¡çµ±è¨ˆ] --> H
        Q[ğŸ’¾ é€šçŸ¥å±¥æ­´] --> G
    end
    
    style E fill:#f3e5f5
    style F fill:#e8f5e8
    style H fill:#fff3e0
    style I fill:#e3f2fd
    style J fill:#e1f5fe
`} />

<div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
<div class="prose max-w-none p-8">

### é€šçŸ¥ãƒ•ãƒ­ãƒ¼è©³ç´°

</div>
</div>

<Mermaid chart={`
sequenceDiagram
    participant T as ã‚¤ãƒ™ãƒ³ãƒˆãƒˆãƒªã‚¬ãƒ¼
    participant E as é€šçŸ¥ã‚¨ãƒ³ã‚¸ãƒ³
    participant D as é…ä¿¡ã‚µãƒ¼ãƒãƒ¼
    participant C as ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
    participant P as ãƒ—ãƒƒã‚·ãƒ¥ã‚µãƒ¼ãƒ“ã‚¹

    T->>E: ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿ
    E->>E: ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šç¢ºèª
    E->>E: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆ
    
    alt ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼
        E->>D: WebSocketé…ä¿¡
        D->>C: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šçŸ¥
        C-->>D: å—ä¿¡ç¢ºèª
    else ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼
        E->>P: ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥
        P->>C: ãƒ‡ãƒã‚¤ã‚¹é€šçŸ¥
        C-->>P: å—ä¿¡ç¢ºèª
    end
    
    E->>E: é…ä¿¡ãƒ­ã‚°è¨˜éŒ²
    
    Note over T,P: ãƒãƒ«ãƒãƒãƒ£ãƒãƒ«é…ä¿¡ä¿è¨¼
`} />

<div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
<div class="prose max-w-none p-8">

## 2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ç®¡ç†

### é€šçŸ¥è¨­å®šã‚·ã‚¹ãƒ†ãƒ 

</div>
</div>

<Mermaid chart={`
graph LR
    subgraph "ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®š"
        U[ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼] --> S[âš™ï¸ è¨­å®šUI]
        S --> P1[ğŸ”” é€šçŸ¥ç¨®åˆ¥è¨­å®š]
        S --> P2[â° æ™‚é–“å¸¯è¨­å®š]
        S --> P3[ğŸ“± ãƒ‡ãƒã‚¤ã‚¹è¨­å®š]
        S --> P4[ğŸ¯ ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼è¨­å®š]
    end
    
    subgraph "è¨­å®šç®¡ç†"
        P1 --> DB[ğŸ’¾ è¨­å®šDB]
        P2 --> DB
        P3 --> DB
        P4 --> DB
        
        DB --> C[âš¡ è¨­å®šã‚­ãƒ£ãƒƒã‚·ãƒ¥]
    end
    
    subgraph "é…ä¿¡åˆ¶å¾¡"
        C --> F[ğŸ” ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°]
        F --> R[ğŸ“Š ãƒ¬ãƒ¼ãƒˆåˆ¶é™]
        R --> Q[â³ ã‚­ãƒ¥ãƒ¼ã‚¤ãƒ³ã‚°]
        Q --> D[ğŸ“¤ é…ä¿¡å®Ÿè¡Œ]
    end
    
    style DB fill:#e8f5e8
    style C fill:#fff3e0
    style F fill:#f3e5f5
    style D fill:#e3f2fd
`} />

<div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
<div class="prose max-w-none p-8">

## 3. ã‚·ã‚¹ãƒ†ãƒ ç›£è¦–ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆã‚·ã‚¹ãƒ†ãƒ 

### ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

</div>
</div>

<Mermaid chart={`
graph TB
    subgraph "ç›£è¦–å¯¾è±¡"
        S1[ğŸ–¥ï¸ Webã‚µãƒ¼ãƒãƒ¼] --> M[ğŸ“Š ç›£è¦–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ]
        S2[ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹] --> M
        S3[ğŸŒ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯] --> M
        S4[ğŸ”§ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³] --> M
    end
    
    subgraph "ã‚¢ãƒ©ãƒ¼ãƒˆå‡¦ç†"
        M --> A[ğŸš¨ ã‚¢ãƒ©ãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³]
        A --> T[ğŸ“ é–¾å€¤åˆ¤å®š]
        T --> E[âš¡ ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³]
        E --> N[ğŸ”” é€šçŸ¥ç”Ÿæˆ]
    end
    
    subgraph "é…ä¿¡å…ˆ"
        N --> WS[WebSocketã‚µãƒ¼ãƒãƒ¼]
        WS --> D1[ğŸ’» ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰]
        WS --> D2[ğŸ“± ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒª]
        WS --> D3[ğŸ“§ ãƒ¡ãƒ¼ãƒ«é€šçŸ¥]
        WS --> D4[ğŸ“² SMSé€šçŸ¥]
    end
    
    subgraph "ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆç®¡ç†"
        N --> I[ğŸ“‹ ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆä½œæˆ]
        I --> W[ğŸ”„ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼]
        W --> R[ğŸ“ å¯¾å¿œè¨˜éŒ²]
    end
    
    style M fill:#f3e5f5
    style A fill:#fff3e0
    style N fill:#e8f5e8
    style WS fill:#e3f2fd
`} />

<div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
<div class="prose max-w-none p-8">

### ã‚¢ãƒ©ãƒ¼ãƒˆã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

</div>
</div>

<Mermaid chart={`
sequenceDiagram
    participant M as ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ 
    participant A as ã‚¢ãƒ©ãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³
    participant T as ãƒãƒ¼ãƒ 
    participant E as ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
    participant L as ãƒªãƒ¼ãƒ€ãƒ¼

    M->>A: ç•°å¸¸æ¤œçŸ¥
    A->>A: é‡è¦åº¦åˆ¤å®š
    
    alt ä½é‡è¦åº¦
        A->>T: Slacké€šçŸ¥
        T-->>A: ç¢ºèª (30åˆ†ä»¥å†…)
    else ä¸­é‡è¦åº¦
        A->>T: WebSocket + ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥
        T-->>A: ç¢ºèª (15åˆ†ä»¥å†…)
        
        alt æœªå¯¾å¿œæ™‚
            A->>E: ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
            E->>L: ç·Šæ€¥é€šçŸ¥
        end
    else é«˜é‡è¦åº¦
        A->>T: å…¨ãƒãƒ£ãƒãƒ«ç·Šæ€¥é€šçŸ¥
        A->>E: å³åº§ã«ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
        A->>L: ãƒªãƒ¼ãƒ€ãƒ¼ç›´æ¥é€šçŸ¥
    end
    
    Note over M,L: é‡è¦åº¦åˆ¥å¯¾å¿œãƒ•ãƒ­ãƒ¼
`} />

<div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
<div class="prose max-w-none p-8">

## 4. PWAçµ±åˆé€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ 

### Service Workeré€£æº

</div>
</div>

<Mermaid chart={`
graph TD
    subgraph "PWAã‚¢ãƒ—ãƒª"
        A[ğŸ“± PWAã‚¢ãƒ—ãƒª] --> SW[ğŸ”„ Service Worker]
        SW --> N[ğŸ”” Notification API]
        SW --> B[ğŸ“‚ Background Sync]
    end
    
    subgraph "WebSocketé€šä¿¡"
        A -->|ã‚¢ã‚¯ãƒ†ã‚£ãƒ–æ™‚| WS[WebSocketã‚µãƒ¼ãƒãƒ¼]
        WS -->|ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ | A
    end
    
    subgraph "ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥"
        PS[ğŸ“¡ Push Service] --> SW
        WS --> PS
        SW --> N
    end
    
    subgraph "ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œ"
        SW --> C[ğŸ’¾ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸]
        B --> WS
        C --> B
    end
    
    subgraph "çµ±åˆåˆ¶å¾¡"
        WS --> UC[ğŸ¯ çµ±åˆåˆ¶å¾¡]
        PS --> UC
        UC --> DM[ğŸ“Š é…ä¿¡ç®¡ç†]
        DM --> L[ğŸ“ ãƒ­ã‚°è¨˜éŒ²]
    end
    
    style SW fill:#f3e5f5
    style WS fill:#e8f5e8
    style UC fill:#fff3e0
    style N fill:#e3f2fd
`} />

<div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
<div class="prose max-w-none p-8">

## 5. å¤§è¦æ¨¡é…ä¿¡ã‚·ã‚¹ãƒ†ãƒ 

### ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«é€šçŸ¥é…ä¿¡

</div>
</div>

<Mermaid chart={`
graph TB
    subgraph "ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼"
        LB[âš–ï¸ WebSocketãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼]
    end
    
    subgraph "WebSocketã‚µãƒ¼ãƒãƒ¼ç¾¤"
        WS1[WebSocketã‚µãƒ¼ãƒãƒ¼1]
        WS2[WebSocketã‚µãƒ¼ãƒãƒ¼2]
        WS3[WebSocketã‚µãƒ¼ãƒãƒ¼3]
        WS4[WebSocketã‚µãƒ¼ãƒãƒ¼N]
    end
    
    subgraph "ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°åŸºç›¤"
        MQ[ğŸ“¡ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚­ãƒ¥ãƒ¼]
        PS[ğŸ“¤ Pub/Subã‚·ã‚¹ãƒ†ãƒ ]
        BR[ğŸ“Š ãƒ–ãƒ­ãƒ¼ã‚«ãƒ¼]
    end
    
    subgraph "é€šçŸ¥å‡¦ç†"
        NE[ğŸ”” é€šçŸ¥ã‚¨ãƒ³ã‚¸ãƒ³ç¾¤]
        FT[ğŸ” ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°]
        RT[ğŸ“Š ãƒ¬ãƒ¼ãƒˆåˆ¶é™]
    end
    
    subgraph "æ°¸ç¶šåŒ–å±¤"
        DB[ğŸ’¾ é€šçŸ¥å±¥æ­´DB]
        CACHE[âš¡ Redisã‚­ãƒ£ãƒƒã‚·ãƒ¥]
        QUEUE[ğŸ“¦ é…å»¶ã‚­ãƒ¥ãƒ¼]
    end
    
    LB --> WS1
    LB --> WS2
    LB --> WS3
    LB --> WS4
    
    WS1 --> PS
    WS2 --> PS
    WS3 --> PS
    WS4 --> PS
    
    PS --> MQ
    MQ --> NE
    NE --> FT
    FT --> RT
    RT --> QUEUE
    
    NE --> CACHE
    RT --> DB
    
    style LB fill:#f3e5f5
    style PS fill:#e8f5e8
    style NE fill:#fff3e0
    style CACHE fill:#e3f2fd
`} />

<div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
<div class="prose max-w-none p-8">

## 6. é€šçŸ¥åˆ†æãƒ»æœ€é©åŒ–

### é…ä¿¡åŠ¹æœæ¸¬å®š

</div>
</div>

<Mermaid chart={`
graph LR
    subgraph "é…ä¿¡ãƒ‡ãƒ¼ã‚¿"
        S[ğŸ“¤ é€ä¿¡ãƒ­ã‚°] --> A[ğŸ“Š åˆ†æã‚¨ãƒ³ã‚¸ãƒ³]
        D[ğŸ“¥ é…ä¿¡ãƒ­ã‚°] --> A
        O[ğŸ‘ï¸ é–‹å°ãƒ­ã‚°] --> A
        C[ğŸ‘† ã‚¯ãƒªãƒƒã‚¯ãƒ­ã‚°] --> A
    end
    
    subgraph "åˆ†æå‡¦ç†"
        A --> M[ğŸ“ˆ ãƒ¡ãƒˆãƒªã‚¯ã‚¹è¨ˆç®—]
        M --> SEG[ğŸ‘¥ ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ†æ]
        SEG --> OPT[âš¡ æœ€é©åŒ–ææ¡ˆ]
    end
    
    subgraph "å¯è¦–åŒ–"
        M --> DB[ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰]
        SEG --> RP[ğŸ“‹ ãƒ¬ãƒãƒ¼ãƒˆ]
        OPT --> AL[ğŸš¨ ã‚¢ãƒ©ãƒ¼ãƒˆ]
    end
    
    subgraph "ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ«ãƒ¼ãƒ—"
        OPT --> TS[â° é…ä¿¡æ™‚é–“æœ€é©åŒ–]
        OPT --> FS[ğŸ¯ ãƒ•ãƒªãƒ¼ã‚±ãƒ³ã‚·ãƒ¼æœ€é©åŒ–]
        OPT --> CS[ğŸ“ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æœ€é©åŒ–]
    end
    
    style A fill:#f3e5f5
    style M fill:#e8f5e8
    style OPT fill:#fff3e0
    style DB fill:#e3f2fd
`} />

<div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
<div class="prose max-w-none p-8">

## ğŸ’¡ å®Ÿè£…ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 1. é€šçŸ¥è¨­å®šç®¡ç†
```javascript
class NotificationPreferences {
  constructor(userId) {
    this.userId = userId;
    this.preferences = this.loadPreferences();
  }
  
  shouldSendNotification(notificationType, timeZone) {
    const pref = this.preferences[notificationType];
    if (!pref.enabled) return false;
    
    const currentTime = new Date().toLocaleString("en-US", {timeZone});
    const hour = new Date(currentTime).getHours();
    
    return hour >= pref.quietHours.start && hour <= pref.quietHours.end;
  }
  
  updatePreference(type, settings) {
    this.preferences[type] = { ...this.preferences[type], ...settings };
    this.savePreferences();
  }
}
```

### 2. ãƒ¬ãƒ¼ãƒˆåˆ¶é™å®Ÿè£…
```javascript
class NotificationRateLimiter {
  constructor() {
    this.userLimits = new Map(); // userId -> { count, resetTime }
    this.globalLimit = { maxPerMinute: 1000, current: 0 };
  }
  
  canSendNotification(userId, notificationType) {
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥åˆ¶é™ãƒã‚§ãƒƒã‚¯
    const userLimit = this.getUserLimit(userId);
    if (userLimit.count >= this.getLimitForType(notificationType)) {
      return false;
    }
    
    // ã‚°ãƒ­ãƒ¼ãƒãƒ«åˆ¶é™ãƒã‚§ãƒƒã‚¯
    if (this.globalLimit.current >= this.globalLimit.maxPerMinute) {
      return false;
    }
    
    return true;
  }
  
  recordNotification(userId) {
    this.incrementUserCount(userId);
    this.globalLimit.current++;
  }
}
```

### 3. é…ä¿¡ä¿è¨¼æ©Ÿèƒ½
```javascript
class ReliableNotificationDelivery {
  constructor() {
    this.pendingNotifications = new Map();
    this.retryDelays = [1000, 5000, 15000, 60000]; // æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•
  }
  
  async sendWithRetry(notification, maxRetries = 3) {
    for (let attempt = 0; attempt <= maxRetries; attempt++) {
      try {
        await this.sendNotification(notification);
        return { success: true, attempts: attempt + 1 };
      } catch (error) {
        if (attempt === maxRetries) {
          throw new Error(`Failed after ${maxRetries + 1} attempts: ${error.message}`);
        }
        
        const delay = this.retryDelays[attempt] || 60000;
        await this.sleep(delay);
      }
    }
  }
  
  handleFailedDelivery(notification, error) {
    // Dead Letter Queue ã¸ã®ç§»å‹•
    this.moveToDeadLetterQueue(notification, error);
    // ç®¡ç†è€…ã¸ã®é€šçŸ¥
    this.notifyAdministrators(notification, error);
  }
}
```

### 4. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ãƒ¡ãƒˆãƒªã‚¯ã‚¹
```javascript
class NotificationMetrics {
  constructor() {
    this.metrics = {
      sent: 0,
      delivered: 0,
      opened: 0,
      clicked: 0,
      failed: 0
    };
    this.setupRealTimeReporting();
  }
  
  setupRealTimeReporting() {
    setInterval(() => {
      this.sendMetricsUpdate();
    }, 5000); // 5ç§’é–“éš”ã§ãƒ¡ãƒˆãƒªã‚¯ã‚¹é€ä¿¡
  }
  
  recordEvent(eventType, metadata = {}) {
    this.metrics[eventType]++;
    
    // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«é€ä¿¡
    this.broadcastMetricUpdate({
      type: eventType,
      count: this.metrics[eventType],
      timestamp: Date.now(),
      metadata
    });
  }
}
```

ã“ã®åŒ…æ‹¬çš„ãªé€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã‚ˆã‚Šã€é«˜å¯ç”¨æ€§ã§ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ãªé€šçŸ¥é…ä¿¡ã‚’å®Ÿç¾ã§ãã¾ã™ã€‚

</div>
</div>