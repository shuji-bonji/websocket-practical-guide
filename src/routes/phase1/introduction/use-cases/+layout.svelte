<script>
  import { page } from '$app/stores';

  let { children } = $props();

  const examples = [
    {
      path: '/phase1/introduction/use-cases',
      title: 'æ¦‚è¦ãƒ»å…¨ä½“åƒ',
      icon: 'ğŸ—ºï¸',
      description: '11ã‚«ãƒ†ã‚´ãƒªãƒ¼ã®ä¿¯ç°å›³'
    },
    {
      path: '/phase1/introduction/use-cases/examples/chat',
      title: 'ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡',
      icon: 'ğŸ’¬',
      description: 'ãƒãƒ£ãƒƒãƒˆãƒ»ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°'
    },
    {
      path: '/phase1/introduction/use-cases/examples/collaboration',
      title: 'å”åƒä½œæ¥­',
      icon: 'ğŸ¤',
      description: 'ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå…±åŒç·¨é›†'
    },
    {
      path: '/phase1/introduction/use-cases/examples/data-streaming',
      title: 'ãƒ‡ãƒ¼ã‚¿é…ä¿¡',
      icon: 'ğŸ“Š',
      description: 'ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ»é…ä¿¡'
    },
    {
      path: '/phase1/introduction/use-cases/examples/finance-medical',
      title: 'é‡‘èãƒ»åŒ»ç™‚',
      icon: 'ğŸ’¹',
      description: 'é«˜å¯ç”¨æ€§ã‚·ã‚¹ãƒ†ãƒ '
    },
    {
      path: '/phase1/introduction/use-cases/examples/iot',
      title: 'IoTãƒ»ç”£æ¥­',
      icon: 'ğŸ­',
      description: 'ã‚»ãƒ³ã‚µãƒ¼ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯'
    },
    {
      path: '/phase1/introduction/use-cases/examples/notifications',
      title: 'é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ ',
      icon: 'ğŸ””',
      description: 'ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆ'
    },
    {
      path: '/phase1/introduction/use-cases/examples/vr-metaverse',
      title: 'VRãƒ»ã‚²ãƒ¼ãƒ ',
      icon: 'ğŸ®',
      description: 'ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ†ã‚¤ãƒ¡ãƒ³ãƒˆ'
    },
    {
      path: '/phase1/introduction/use-cases/examples/pwa',
      title: 'PWAçµ±åˆ',
      icon: 'ğŸ“±',
      description: 'ãƒ¢ãƒã‚¤ãƒ«ãƒ»ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œ'
    },
    {
      path: '/phase1/introduction/use-cases/examples/security',
      title: 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£',
      icon: 'ğŸ”',
      description: 'èªè¨¼ãƒ»æš—å·åŒ–'
    },
    {
      path: '/phase1/introduction/use-cases/examples/backend',
      title: 'ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰',
      icon: 'âš™ï¸',
      description: 'ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰å®Ÿè£…'
    },
    {
      path: '/phase1/introduction/use-cases/examples/simulation',
      title: 'ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³',
      icon: 'ğŸ”„',
      description: 'ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¨ˆç®—'
    }
  ];

  let currentPath = $state($page.url.pathname);
  let sidebarOpen = $state(false);

  // ãƒ‘ã‚¹ã«åŸºã¥ã„ã¦ç¾åœ¨ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’åˆ¤å®š
  let isExamplePage = $derived(currentPath.includes('/examples/'));

  // ãƒšãƒ¼ã‚¸å¤‰æ›´æ™‚ã«ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚’é–‰ã˜ã‚‹
  $effect(() => {
    currentPath = $page.url.pathname;
    sidebarOpen = false;
  });
</script>

<!-- ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ä»˜ç®‹ã‚¢ã‚¤ã‚³ãƒ³ -->
<button
  class="fixed top-20 right-4 z-50 bg-yellow-400 hover:bg-yellow-500 text-gray-800 px-4 py-3 rounded-lg shadow-lg transition-all duration-200 hover:scale-105 flex items-center gap-2"
  onclick={() => (sidebarOpen = !sidebarOpen)}
  title="WebSocketåˆ©ç”¨ä¾‹ä¸€è¦§"
>
  <span class="text-lg">ğŸ“‹</span>
  <span class="text-sm font-medium">WebSocketåˆ©ç”¨ä¾‹ä¸€è¦§</span>
</button>

<!-- ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
{#if sidebarOpen}
  <div
    class="fixed inset-0 bg-black bg-opacity-50 z-40 transition-opacity duration-300"
    role="button"
    tabindex="0"
    onclick={() => (sidebarOpen = false)}
    onkeydown={(e) => e.key === 'Escape' && (sidebarOpen = false)}
    aria-label="ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚’é–‰ã˜ã‚‹"
  ></div>
{/if}

<!-- ã‚¹ãƒ©ã‚¤ãƒ‰å¼ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
<aside
  class="fixed top-16 right-0 h-[calc(100vh-4rem)] w-80 bg-white shadow-xl border-l border-gray-200 overflow-y-auto z-50 transform transition-transform duration-300 {sidebarOpen
    ? 'translate-x-0'
    : 'translate-x-full'}"
>
  <div class="p-6">
    <div class="flex items-center justify-between mb-6">
      <h2 class="text-xl font-bold text-gray-900">ğŸ“‹ WebSocketåˆ©ç”¨ä¾‹</h2>
      <button
        class="text-gray-500 hover:text-gray-700 p-1"
        onclick={() => (sidebarOpen = false)}
        aria-label="ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚’é–‰ã˜ã‚‹"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"
          ></path>
        </svg>
      </button>
    </div>

    <nav class="space-y-2">
      {#each examples as example (example.path)}
        <a
          href={example.path}
          class="block px-4 py-3 rounded-lg transition-colors duration-200 {currentPath ===
          example.path
            ? 'bg-blue-50 border-l-4 border-blue-500 text-blue-700'
            : 'hover:bg-gray-50 text-gray-700'}"
        >
          <div class="flex items-start">
            <span class="text-xl mr-3 mt-0.5">{example.icon}</span>
            <div>
              <div class="font-medium">{example.title}</div>
              <div class="text-sm text-gray-500 mt-1">{example.description}</div>
            </div>
          </div>
        </a>
      {/each}
    </nav>

    {#if isExamplePage}
      <div class="mt-8 p-4 bg-blue-50 rounded-lg">
        <h3 class="font-semibold text-blue-900 mb-2">ğŸ’¡ å­¦ç¿’ã®ãƒ’ãƒ³ãƒˆ</h3>
        <p class="text-sm text-blue-800">
          å„å®Ÿè£…ä¾‹ã«ã¯è©³ç´°ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³ã¨ã‚³ãƒ¼ãƒ‰ä¾‹ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚æ¦‚è¦ãƒšãƒ¼ã‚¸ã¨åˆã‚ã›ã¦å­¦ç¿’ã™ã‚‹ã“ã¨ã§ã€ã‚ˆã‚Šæ·±ã„ç†è§£ãŒå¾—ã‚‰ã‚Œã¾ã™ã€‚
        </p>
      </div>
    {/if}
  </div>
</aside>

<!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
<main class="w-full overflow-y-auto">
  <div class="mx-auto">
    {@render children()}
  </div>
</main>

<style>
  /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° */
  aside {
    scrollbar-width: thin;
    scrollbar-color: #d1d5db #f9fafb;
  }

  aside::-webkit-scrollbar {
    width: 6px;
  }

  aside::-webkit-scrollbar-track {
    background: #f9fafb;
  }

  aside::-webkit-scrollbar-thumb {
    background: #d1d5db;
    border-radius: 3px;
  }

  aside::-webkit-scrollbar-thumb:hover {
    background: #9ca3af;
  }

  /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼è¨­å®š */
  main {
    overflow: visible !important;
  }

  /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å†…ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚«ãƒ¼ãƒ‰ã®ã‚·ãƒ£ãƒ‰ã‚¦ã‚’ç¢ºå®Ÿã«è¡¨ç¤º */
  :global(.lesson-content section.floating-card) {
    position: relative;
    z-index: 1;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1) !important;
  }

  /* lesson-contentã®ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼è¨­å®šã®ã¿ï¼ˆå¹…ã¯å¤‰æ›´ã—ãªã„ï¼‰ */
  :global(.lesson-content) {
    overflow: visible !important;
  }
</style>
